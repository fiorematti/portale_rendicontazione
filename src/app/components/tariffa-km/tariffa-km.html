<div class="page-wrapper p-3 min-vh-100">
	<h1 class="page-title mb-4">Tariffa Km</h1>

	<div class="mb-4">
		<div class="search-card p-3 rounded-4 shadow-sm d-flex flex-wrap align-items-center gap-3">
			<div class="flex-grow-1 min-width-0">
				<label class="search-label d-block mb-2">Cerca</label>
				<div class="search-input d-flex align-items-center">
					<i class="bi bi-search me-2 text-muted"></i>
					<input
						type="text"
						[(ngModel)]="filtroTesto"
						class="form-control border-0 shadow-none"
						placeholder="Cerca..."
					/>
				</div>
			</div>

			<button class="btn btn-add px-4 py-2 rounded-4 shadow-sm d-inline-flex align-items-center" (click)="apriModal()">
				<i class="bi bi-plus-lg me-2"></i>
				<span>Aggiungi Auto</span>
			</button>
		</div>
	</div>

	<div class="table-card bg-white rounded-4 shadow-sm overflow-hidden">
		<div class="table-responsive">
			<table class="table align-middle mb-0">
				<thead class="table-light">
					<tr>
						<th class="ps-4">Utente</th>
						<th>Auto</th>
						<th>Tariffa chilometrica</th>
						<th class="pe-4 text-end">Azioni</th>
					</tr>
				</thead>
				<tbody>
					@for (item of acquirentiFiltrati; track item.id) {
					<tr>
						<td class="ps-4 text-nowrap">{{ item.utente }}</td>
						<td class="text-nowrap">{{ item.auto }}</td>
						<td class="text-nowrap">{{ item.tariffaKm | number:'1.4-4' }}</td>
						<td class="pe-4 text-end text-nowrap d-flex gap-2 justify-content-end align-items-center">
							<button class="btn btn-link text-dark p-1" (click)="apriDettaglio(item)">
								<i class="bi bi-eye"></i>
							</button>
							<button class="btn btn-link text-dark p-1" (click)="elimina(item)">
								<i class="bi bi-trash3"></i>
							</button>
							<button class="btn btn-link text-dark p-1" (click)="modifica(item)">
								<i class="bi bi-pencil"></i>
							</button>
						</td>
					</tr>
					} @empty {
					<tr>
						<td colspan="4" class="text-center py-4 text-muted">Nessun acquirente trovato.</td>
					</tr>
					}
				</tbody>
			</table>
		</div>
	</div>
</div>

@if (isModalOpen) {
<div class="modal-overlay" (click)="chiudiModal()">
	<div class="modal-card" (click)="$event.stopPropagation()">
		<h2 class="modal-title">{{ isEditMode ? 'Modifica Auto' : 'Aggiungi Auto' }}</h2>

		@if (mostraErrore) {
		<div class="alert alert-danger border-0 shadow-sm d-flex align-items-center mb-3" role="alert" style="border-radius: 12px;">
			<i class="bi bi-exclamation-circle-fill me-2"></i>
			<div>Compila tutti i campi con valori validi.</div>
		</div>
		}

		<div class="row g-3">
			<div class="col-12">
				<label class="form-label fw-bold">Utente</label>
				<input type="text" class="form-control input-soft" [(ngModel)]="acquirenteSelezionato.utente" placeholder="Nome Cognome" />
			</div>
			<div class="col-12">
				<label class="form-label fw-bold">Auto</label>
				<input type="text" class="form-control input-soft" [(ngModel)]="acquirenteSelezionato.auto" placeholder="Modello" />
			</div>
			<div class="col-12">
				<label class="form-label fw-bold">Tariffa chilometrica</label>
				<input type="number" step="0.0001" class="form-control input-soft" [(ngModel)]="acquirenteSelezionato.tariffaKm" placeholder="0.1234" />
			</div>
		</div>

		<div class="d-flex justify-content-center gap-3 mt-4">
			<button type="button" class="btn btn-dark px-4" (click)="chiudiModal()">Annulla</button>
			<button type="button" class="btn btn-confirm-orange px-4 text-white" (click)="salvaAcquirente()">Conferma</button>
		</div>
	</div>
</div>
}

@if (isDettaglioOpen) {
<div class="modal-overlay" (click)="chiudiDettaglio()">
	<div class="modal-card modal-card-detail" (click)="$event.stopPropagation()">
		<div class="d-flex justify-content-between align-items-start mb-3">
			<h2 class="modal-title mb-0">Auto di {{ acquirenteDettaglio?.utente }}</h2>
		</div>

		<div class="detail-table-wrapper">
			<table class="table mb-0 detail-table">
				<thead>
					<tr>
						<th>Auto</th>
						<th>Tariffa chilometrica</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>{{ acquirenteDettaglio?.auto }}</td>
						<td>{{ acquirenteDettaglio?.tariffaKm | number:'1.4-4' }}</td>
					</tr>
				</tbody>
			</table>
		</div>

		<div class="d-flex justify-content-center gap-3 mt-4">
			<button type="button" class="btn btn-dark px-4" (click)="chiudiDettaglio()">Esci</button>
			<button type="button" class="btn btn-confirm-orange px-4 text-white" (click)="modificaDaDettaglio()">Modifica</button>
		</div>
	</div>
</div>
}
